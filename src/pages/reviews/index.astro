---
import DocsLayout from '../../layouts/DocsLayout.astro';
import { getCollection } from 'astro:content';
const posts = (await getCollection('reviews', p => !p.data.draft)).sort((a,b) => (a.data.date < b.data.date ? 1 : -1));
const cats = Array.from(new Set(posts.map(p => p.data.category).filter(Boolean)));
const sidebarLinks = [{ href: '/reviews/', label: '전체' }, ...cats.map(c => ({ href: '/reviews/?cat=' + encodeURIComponent(c), label: c }))];
const url = new URL(Astro.request.url);
const cat = url.searchParams.get('cat');
const visible = cat ? posts.filter(p => p.data.category === cat) : posts;
---
<DocsLayout sidebarTitle="카테고리" {sidebarLinks}>
  <h1>논문 리뷰</h1>
  {cat && <p class="small">카테고리: <strong>{cat}</strong> • <a href="/reviews/">카테고리 해제</a></p>}
  <div class="post-list">
    {visible.map((p) => (
      <article class="post-item">
        <h3><a href={`/reviews/${p.slug}/`}>{p.data.title}</a></h3>
        <div class="small">{p.data.date}{p.data.tags.length ? ` • ${p.data.tags.join(', ')}` : ''}</div>
        {p.data.summary && <p style="margin:.4rem 0 0 0;">{p.data.summary}</p>}
      </article>
    ))}
  </div>
</DocsLayout>

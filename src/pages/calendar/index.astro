---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { AUTH, CALENDAR } from "../../site.config";
import calendarScript from "../../scripts/calendar-page.js?url";  // ✅ 추가
---

<style is:global>
  /* FullCalendar CSS는 CDN으로 전역 주입 (패키지 CSS import 금지) */
  @import url("https://cdn.jsdelivr.net/npm/@fullcalendar/common@6.1.19/main.min.css");
  @import url("https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.19/main.min.css");
</style>

<BaseLayout title="달력">
  <h1>달력</h1>

  <!-- (비로그인) 공개 캘린더 임베드 -->
  <section class="card only-signed-out" id="public-embed">
    <p class="small">로그인하면 내 캘린더를 읽고/쓸 수 있습니다.</p>
    <div style="overflow:hidden">
      <iframe
        src={`https://calendar.google.com/calendar/embed?src=${encodeURIComponent(CALENDAR.id)}&ctz=${encodeURIComponent(CALENDAR.timezone)}&mode=MONTH`}
        style="width:100%; height:70vh; border:0" loading="lazy">
      </iframe>
    </div>
  </section>

  <!-- (로그인) 달력 뷰 + 쓰기 버튼 -->
  <section class="card only-signed-in">
    <div>
      <strong>내 캘린더 (primary)</strong>
      <div class="small">로그인 계정이 <code>{AUTH.ownerEmail}</code>일 때만 버튼이 보입니다.</div>
    </div>
    <div id="owner-actions" style="display:none; gap:.5rem;">
      <button class="button" id="btnCreate">이벤트 만들기</button>
    </div>
    <hr class="sep" />
    <div id="calendar" style="min-height: 650px;"></div>
  </section>

  <!-- ✅ 번들된 모듈을 파일로 로드 (인라인 import 금지) -->
  <script type="module" src={calendarScript}></script>

  <style is:global>
    #calendar :global(.fc) {
      --fc-border-color: var(--border);
      --fc-button-bg-color: var(--surface);
      --fc-button-text-color: var(--fg);
      --fc-button-border-color: var(--border);
      --fc-page-bg-color: var(--surface);
      --fc-neutral-bg-color: var(--surface);
      --fc-list-event-hover-bg-color: var(--surface);
    }
  </style>
</BaseLayout>

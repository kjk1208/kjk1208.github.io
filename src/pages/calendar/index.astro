---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { AUTH, CALENDAR } from "../../site.config";
---

<style is:global>
  @import url("https://cdn.jsdelivr.net/npm/@fullcalendar/common@6.1.19/main.min.css");
  @import url("https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.19/main.min.css");
</style>

<BaseLayout title="달력">
  <h1>달력</h1>

  <!-- 비로그인 -->
  <section class="card only-signed-out" id="public-embed">
    <p class="small">로그인하면 내 캘린더를 읽고/쓸 수 있습니다.</p>
    <div style="overflow:hidden">
      <iframe
        src={`https://calendar.google.com/calendar/embed?src=${encodeURIComponent(CALENDAR.id)}&ctz=${encodeURIComponent(CALENDAR.timezone)}&mode=MONTH`}
        style="width:100%; height:70vh; border:0" loading="lazy">
      </iframe>
    </div>
  </section>

  <!-- 로그인 -->
  <section class="card only-signed-in">
    <div>
      <strong>내 캘린더 (primary)</strong>
      <div class="small">로그인 계정이 <code>{AUTH.ownerEmail}</code>일 때만 버튼이 보입니다.</div>
    </div>
    <div id="owner-actions" style="display:none; gap:.5rem;">
      <button class="button" id="btnCreate">이벤트 만들기</button>
    </div>
    <hr class="sep" />
    <div id="calendar" style="min-height: 650px;"></div>
  </section>

  <!-- 클라이언트 실행: 번들된 모듈을 브라우저에서 import -->
  <script type="module">
    import { initCalendar } from '/src/scripts/calendar-page.js';
    const run = () => {
      const el = document.getElementById('calendar');
      if (el) initCalendar(el);
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', run);
    } else {
      run();
    }
</BaseLayout>